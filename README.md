# Сервис аутентификации

Микросервис аутентификации для платформы ExRateHub, отвечающий за регистрацию пользователей, вход, управление API-ключами и выдачу JWT-токенов.

## Содержание

- [Архитектура](#архитектура)
- [Начало работы](#начало-работы)
  - [Требования](#требования)
  - [Установка](#установка)
  - [Конфигурация](#конфигурация)
- [Конечные точки API](#конечные-точки-api)
- [Непрерывная интеграция](#непрерывная-интеграция)
- [Участие в проекте](#участие-в-проекте)
- [Лицензия](#лицензия)

## Архитектура

Следует принципам **Чистой архитектуры**:

- `domain/` – сущности (например, `User`, `APIKey`) и доменные исключения  
- `application/` – юзкейсы и бизнес-логика (регистрация, аутентификация)  
- `infrastructure/` – адаптеры внешних ресурсов (БД, JWT-провайдер)  
- `interface/` – HTTP-слой: маршруты, сериализаторы, зависимости  
- `tests/` – юнит- и интеграционные тесты, повторяющие структуру кода  

## Начало работы

### Требования

- Python 3.13  
- PostgreSQL  
- `uv` для управления зависимостями  

### Установка

Клонируйте репозиторий:

```bash
git clone git@github.com:ExRateHub/auth-service.git
cd auth-service
```

Установите зависимости:

```bash
uv install
```

### Конфигурация

Скопируйте пример файла окружения и задайте свои значения:

```bash
cp .env.example .env
# Отредактируйте .env, указав DATABASE_URL, JWT_SECRET_KEY и т.д.
```

Обязательные переменные окружения:


## Конечные точки API

| Метод | Путь                          | Описание                                                                                       |
|-------|-------------------------------|------------------------------------------------------------------------------------------------|
| POST  | /v1/auth/register           | Регистрация пользователя (принимает email и password)                                       |
| POST  | /v1/auth/login              | Аутентификация пользователя (принимает email и password, возвращает access/refresh JWT)     |
| GET   | /v1/auth/confirm-email      | Подтверждение email по токену подтверждения (параметр token в query)                         |
| POST  | /v1/auth/request-password-reset | Запрос на сброс пароля (принимает email, отправляет письмо со ссылкой для сброса)        |
| POST  | /v1/auth/reset-password     | Сброс пароля (принимает token и new_password)                                              |
| POST  | /v1/auth/change-password    | Смена пароля для авторизованного пользователя (принимает current_password и new_password)  |
| POST  | /v1/auth/refresh-token      | Обновление access-токена по refresh-токену (принимает refresh_token, возвращает новый access и refresh JWT)  |


## Непрерывная интеграция

В `.github/workflows/auth.yml` настроен CI, включающий:

- Запуск `ruff` и `mypy`  
- Прогоны тестов через `pytest`  

## Участие в проекте

Методология разработки: GitFlow

Пожалуйста, открывайте pull requests в ветку `develop`. Обсуждаем изменения через GitHub Issues.

## Лицензия

© 2025 ООО «ExRateHub». Все права защищены.
